# 4주차 복습

## 레포지토리 계층

- 데이터베이스와 소통하며 데이터를 조작하는 계층
- 서비스 계층이 결정한 비즈니스 로직을 실제 DB에 적용
- 데이터 조작 ; CRUD 기능 위주로 구현 => JPA가 제공하는 기능 이용

## Entity Manager

- 스프링 어플리케이션과 데이터베이스의 직접적인 소통을 대신 해주는 '객체'
- JPA는 application.yml 정보를 통해 entity manager를 생성

### Entity Manager의 역할

1. 새로 생성한 엔티티 객체를 DB에 추가
2. DB에서 조회한 데이터로 엔티티 객체 만들기
3. 엔티티 객체에 대한 수정, 삭제를 DB에 반영

## 트랜잭션 (`@Transactional`)

- 데이터를 조작하는 행위들에 대한 쪼갤 수 없는 큰 동작 단위

- JPA는 트랜잭션 단위로 동작
- 하나의 트랜잭션이 끝나면 모든 변경사항을 DB에 반영함. (최종본) 하지만 하나의 트랜잭션이 완료되기 전, 즉 중간에 에러가 발생하면 롤백을 하여 트랜잭션 범위 안의 모든 변경점을 되돌림

## 영속성 컨텍스트

- DB에서 조회한 엔티티를 캐싱하는 공간으로, 일종의 버퍼 역할을 함
- JPA가 DB에 최종적으로 반영할 엔티티의 모든 변경사항을 보관하는 중간 공간
  - 엔티티에 대한 변경사항을 영속성 컨텍스트에 저장해 두었다가, 트랜잭션을 커밋하면 저장된 모든 변경점이 DB에 반영되도록 영속성 컨텍스트를 기반으로 한번에 쿼리를 생성

```
1. 데이터 생성
em.persist() ( = 영속성 컨텍스트에 신규 엔티티 객체 등록)

2. 데이터 조회
em.find() (= 데이터베이스에서 엔티티 객체 조회)

3. 데이터 수정
조회한 엔티티 객체를 수정하면 트랜잭션이 끝날 때 알아서 반영
엔티티 클래스와 필드를 수정하는 메서드를 작성하여 수정

4. 데이터 삭제
em.remove() (= 영속성 컨텍스트에 엔티티 삭제 표시)
```
